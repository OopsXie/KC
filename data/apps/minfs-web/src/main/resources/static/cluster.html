<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>集群监控 - MinFS 文件系统</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="cluster.css">
</head>
<body>
    <div class="container">
        <!-- Logo in top-left corner -->
        <div class="logo-overlay">
            <img src="logo.png" alt="金山云" class="logo-topleft">
        </div>

        <!-- Navigation -->
        <div class="nav-bar">
            <a href="index.html" class="nav-link">
                <i class="fas fa-arrow-left"></i> 返回文件管理
            </a>
            <h1 class="page-title">
                <i class="fas fa-server"></i> 集群监控中心
            </h1>
            <div class="nav-actions">
                <button class="btn btn-secondary" onclick="refreshClusterInfo()">
                    <i class="fas fa-sync-alt"></i> 刷新
                </button>
                <button class="btn btn-success" onclick="showBatchControlModal()">
                    <i class="fas fa-cogs"></i> 批量控制
                </button>
            </div>
        </div>

        <!-- Alert Messages -->
        <div id="alertSuccess" class="alert alert-success">
            <i class="fas fa-check-circle"></i> <span id="successMessage"></span>
        </div>
        <div id="alertError" class="alert alert-error">
            <i class="fas fa-exclamation-circle"></i> <span id="errorMessage"></span>
        </div>
        
        <!-- Info Alert -->
        <div class="alert alert-info" style="display: block; margin-bottom: 20px;">
            <i class="fas fa-info-circle"></i> 
            <span>服务器即使停止运行，仍会显示在此页面，您可以随时通过按钮重新启动服务。</span>
        </div>

        <!-- Cluster Overview -->
        <div class="cluster-overview">
            <div class="overview-card">
                <div class="card-icon meta-server">
                    <i class="fas fa-database"></i>
                </div>
                <div class="card-content">
                    <h3>元数据服务器</h3>
                    <div class="metric-value" id="totalMetaServers">-</div>
                    <div class="metric-label">总数量</div>
                </div>
            </div>
            
            <div class="overview-card">
                <div class="card-icon data-server">
                    <i class="fas fa-hdd"></i>
                </div>
                <div class="card-content">
                    <h3>数据服务器</h3>
                    <div class="metric-value" id="totalDataServers">-</div>
                    <div class="metric-label">总数量</div>
                </div>
            </div>
            
            <div class="overview-card">
                <div class="card-icon cluster-status">
                    <i class="fas fa-heartbeat"></i>
                </div>
                <div class="card-content">
                    <h3>集群状态</h3>
                    <div class="metric-value" id="clusterStatus">检查中</div>
                    <div class="metric-label">运行状态</div>
                </div>
            </div>
            
            <div class="overview-card">
                <div class="card-icon storage-usage">
                    <i class="fas fa-chart-pie"></i>
                </div>
                <div class="card-content">
                    <h3>存储使用率</h3>
                    <div class="metric-value" id="storageUsage">-</div>
                    <div class="metric-label">总体使用</div>
                </div>
            </div>
        </div>

        <!-- Server Details -->
        <div class="server-details">
            <!-- Meta Servers Section -->
            <div class="server-section">
                <div class="section-header">
                    <h2><i class="fas fa-database"></i> 元数据服务器</h2>
                    <div class="section-badge" id="metaServerBadge">-</div>
                </div>
                <div class="server-grid" id="metaServerGrid">
                    <!-- 元数据服务器将在这里动态加载 -->
                </div>
            </div>

            <!-- Data Servers Section -->
            <div class="server-section">
                <div class="section-header">
                    <h2><i class="fas fa-hdd"></i> 数据服务器</h2>
                    <div class="section-badge" id="dataServerBadge">-</div>
                </div>
                <div class="server-grid" id="dataServerGrid">
                    <!-- 数据服务器将在这里动态加载 -->
                </div>
            </div>
        </div>

        <!-- System Information -->
        <div class="system-info">
            <div class="info-card">
                <h3><i class="fas fa-info-circle"></i> 系统信息</h3>
                <div class="info-content" id="systemInfo">
                    <div class="info-item">
                        <span class="info-label">连接地址:</span>
                        <span class="info-value">http://10.212.217.58:2379</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">命名空间:</span>
                        <span class="info-value">/minfs</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">最后更新:</span>
                        <span class="info-value" id="lastUpdate">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
                <p>正在获取集群信息...</p>
            </div>
        </div>

        <!-- Server Control Modal -->
        <div class="modal" id="serverControlModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>服务器控制</h3>
                    <span class="close" onclick="closeModal('serverControlModal')">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="control-section">
                        <h4><i class="fas fa-database"></i> MetaServer 控制</h4>
                        <div class="control-group">
                            <label>服务器ID (可选):</label>
                            <input type="text" id="metaServerId" placeholder="留空则批量控制所有MetaServer (1-3)">
                            <small class="help-text">输入具体ID（如：1）控制单个服务器，留空则批量控制所有服务器</small>
                        </div>
                        <div class="control-buttons">
                            <button class="btn btn-success" onclick="controlServer('meta', 'start')">
                                <i class="fas fa-play"></i> 启动
                            </button>
                            <button class="btn btn-danger" onclick="controlServer('meta', 'stop')">
                                <i class="fas fa-stop"></i> 停止
                            </button>

                            <button class="btn" onclick="controlServer('meta', 'status')">
                                <i class="fas fa-info-circle"></i> 状态
                            </button>
                        </div>
                    </div>
                    
                    <div class="control-section">
                        <h4><i class="fas fa-hdd"></i> DataServer 控制</h4>
                        <div class="control-group">
                            <label>服务器ID (可选):</label>
                            <input type="text" id="dataServerId" placeholder="留空则批量控制所有DataServer (1-4)">
                            <small class="help-text">输入具体ID（如：1）控制单个服务器，留空则批量控制所有服务器</small>
                        </div>
                        <div class="control-buttons">
                            <button class="btn btn-success" onclick="controlServer('data', 'start')">
                                <i class="fas fa-play"></i> 启动
                            </button>
                            <button class="btn btn-danger" onclick="controlServer('data', 'stop')">
                                <i class="fas fa-stop"></i> 停止
                            </button>

                            <button class="btn" onclick="controlServer('data', 'status')">
                                <i class="fas fa-info-circle"></i> 状态
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Command Output Modal -->
        <div class="modal" id="commandOutputModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>命令执行结果</h3>
                    <span class="close" onclick="closeModal('commandOutputModal')">&times;</span>
                </div>
                <div class="modal-body">
                    <pre id="commandOutput" class="command-output"></pre>
                    <div class="modal-actions">
                        <button class="btn" onclick="closeModal('commandOutputModal')">关闭</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="cluster.js"></script>
</body>
</html>
